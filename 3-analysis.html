<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<title>Introduction</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove the comments around the @import statement below when using this as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
#map_canvas img,#map_canvas embed,#map_canvas object,.map_canvas img,.map_canvas embed,.map_canvas object{max-width:none!important}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
.antialiased,body{-webkit-font-smoothing:antialiased}
img{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{display:inline-block;color:rgba(0,0,0,.8);font-size:.75em;line-height:1.4;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:-.15em .15em 0 .15em;padding:.2em .6em .2em .5em;vertical-align:middle;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.05em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.spread{width:100%}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1{padding-right:.75em;font-weight:bold}
td.hdlist1,td.hdlist2{vertical-align:top}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none}
span.footnote,span.footnoteref{vertical-align:super;font-size:.875em}
span.footnote a,span.footnoteref a{text-decoration:none}
span.footnote a:active,span.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em;line-height:1.3;font-size:.875em;margin-left:1.2em;text-indent:-1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
h1,h2{letter-spacing:-.01em}
dt,th.tableblock,td.content{text-rendering:optimizeLegibility}
p,td.content{letter-spacing:-.01em}
p strong,td.content strong{letter-spacing:-.005em}
p,blockquote,dt,td.content{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img{page-break-inside:avoid}
thead{display:table-header-group}
img{max-width:100%!important}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
</head>
<body class="book">
<div id="header">
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel2">
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_product_backlog">Product Backlog</a></li>
<li><a href="#_legal_framework">Legal framework</a></li>
<li><a href="#_design">Design</a></li>
<li><a href="#_development">Development</a></li>
<li><a href="#_installation_and_usage">Installation and usage</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph lead">
<p>This chapter contains a detailed description of the analysis performed, the user stories extracted and implemented, as
well as some notes about the development process.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_introduction">Introduction</h3>
<div class="paragraph">
<p>The methodology used to develop this project is <strong>Scrum</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="scrum.png" alt="scrum">
</div>
<div class="title">Figure 1. Scrum overview by <a href="https://www.mountaingoatsoftware.com/agile/scrum/images">Mountain Goat Software</a></div>
</div>
<div class="paragraph">
<p>Scrum is an agile process most commonly used for product development, especially software development. Scrum is a
project management framework that is applicable to any project with aggressive deadlines, complex requirements and a
degree of uniqueness. In Scrum, projects move forward via a series of iterations called sprints. Each sprint is typically
two to four weeks long.</p>
</div>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>Scrum defines the following concepts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Scrum team</strong>: A typical scrum team has between five and nine people, but Scrum projects can easily scale into the
hundreds. However, Scrum can easily be used by one-person teams and often is. This team does not include any of the
traditional software engineering roles such as programmer, designer, tester or architect. Everyone on the project
works together to complete the set of work they have collectively committed to complete within a sprint. Scrum teams
develop a deep form of camaraderie and a feeling that “we’re all in this together.”</p>
</li>
<li>
<p><strong>Product owner</strong>: The product owner is the project’s key stakeholder and represents users, customers and others in the
process. The product owner is often someone from product management or marketing, a key stakeholder or a key user.</p>
</li>
<li>
<p><strong>Scrum Master</strong>: The Scrum Master is responsible for making sure the team is as productive as possible. The Scrum Master
does this by helping the team use the Scrum process, by removing impediments to progress, by protecting the team from
outside, and so on.</p>
</li>
<li>
<p><strong>Product backlog</strong>: The product backlog is a prioritized features list containing every desired feature or change to the
product. Note: The term “backlog” can get confusing because it’s used for two different things. To clarify, the product
backlog is a list of desired features for the product. The sprint backlog is a list of tasks to be completed in a sprint.</p>
</li>
<li>
<p><strong>Sprint planning meeting</strong>: At the start of each sprint, a sprint planning meeting is held, during which the product
owner presents the top items on the product backlog to the team. The Scrum team selects the work they can complete
during the coming sprint. That work is then moved from the product backlog to a sprint backlog, which is the list of
tasks needed to complete the product backlog items the team has committed to complete in the sprint.</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<div class="ulist">
<ul>
<li>
<p><strong>Daily Scrum</strong>: Each day during the sprint, a brief meeting called the daily scrum is conducted. This meeting helps set
the context for each day’s work and helps the team stay on track. All team members are required to attend the daily scrum.</p>
</li>
<li>
<p><strong>Sprint review meeting</strong>: At the end of each sprint, the team demonstrates the completed functionality at a sprint
review meeting, during which, the team shows what they accomplished during the sprint. Typically, this takes the form
of a demonstration of the new features, but in an informal way; for example, PowerPoint slides are not allowed. The
meeting must not become a task in itself nor a distraction from the process.</p>
</li>
<li>
<p><strong>Sprint retrospective</strong>: Also at the end of each sprint, the team conducts a sprint retrospective, which is a meeting
during which the team (including its ScrumMaster and product owner) reflect on how well Scrum is working for them and
what changes they may wish to make for it to work even better.</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_product_backlog">Product Backlog</h3>
<div class="paragraph">
<p>The software requirements are defined through Scrum&#8217;s <strong>user stories</strong>.</p>
</div>
<div class="paragraph">
<p>User stories are short, simple descriptions of a feature told from the perspective of the person who desires the new
capability, usually a user or customer of the system. They typically follow a simple template:</p>
</div>
<div class="quoteblock">
<blockquote>
As a &lt;type of user&gt;, I want &lt;some goal&gt; so that &lt;some reason&gt;.
</blockquote>
</div>
<div class="paragraph">
<p>User stories are often written on index cards or sticky notes, stored in a shoe box, and arranged on walls or tables to
facilitate planning and discussion. As such, they strongly shift the focus from writing about features to discussing them.
In fact, these discussions are more important than whatever text is written.</p>
</div>
<div class="sect3">
<h4 id="__1_as_a_user_i_want_to_authenticate_so_that_i_can_access_protected_resources">#1. As a user, I want to authenticate, so that I can access protected resources</h4>
<div class="paragraph">
<p>The authentication endpoint must enable a client application to login using credentials such as username and password.
It should be RESTful, i.e.: it should consume and produce JSON over HTTP. An example request is like:</p>
</div>
<div class="listingblock">
<div class="title">Listing 1. User Story 1: authentication endpoint.</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">POST /login HTTP/1.1
Host: api.example.com
Content-Type: application/json
{
    "username": "admin",
    "password": "secret"
}</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>If the authentication is successful, the response should be like:</p>
</div>
<div class="listingblock">
<div class="title">Listing 2. User Story 1: successful authentication response</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">200 OK HTTP/1.1
Content-Type: application/json
{
   "username": "admin",
   "roles": [
      "ROLE_ADMIN",
      "ROLE_USER"
   ],
   "expires_in": 3600,
   "token_type": "Bearer",
   "refresh_token": "eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00ifQ.fUaSWIdZakFX7CyimRIPhuw0sfevgmwL2xzm5H0TuaqwKx24EafCO0TruGKG-lN-wGCITssnF2LQTqRzQGp0PoLXHfUJ0kkz5rBl6LtnRu7cdD1ZUNYXLJtFjQ3IATzoo15tPafRPyStG1Qm7-1L0VxquhrLxkkpti0F1_VTytZAq8ltFrnxM4ahJUwS7eriivvdLqmHtnwuXw0kBXEseIyCkiyKklWDJAcD_P_gHoQJvSCoXedlr7Pp0n6LEUrRWJ2Hb-Zyt9dWqWDxm9nyDeEVtEZGcQtpgCGgbXxaUpULIy5nvrbRzXSNyT6iXhK1CLqiFVkfh-Y-DHXdB6Q4sg.uYdpxl835KnlkqC5.gBgSnPWZOo6FINovJNG7Xx2RuS09QJbU4-_J4EgZQkygt8xE-HfdYaOmtmJLjGJR1XKoaRsuX1gNjFoCZgqWAon6.Zsrk52dkjskSVQLXZBQooQ",
   "access_token": "eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00ifQ.n-gGe65x0SlSXS3fTG8ZLdXvv6b5_1pDvkcGyCjFy-vm1VhaBEQL5p3hc6iUcCAcuyrqzGk95lV9dHCv46cNfCiUFHWfbEcd4nqScIxBbc28xO9L1mNLnZ0G1rx1Mx1L0Y_ZPoSxDXpJaHCT28cdZffHLxx2B9ioIClgdlYBAJ5Oz8VT39-D0QSomS6QhFqmcpbDsXrsKxs545Pn-TIlu-fSQ4wpIvAxusOKB6CV2EYKqBplMBrh-3btE8WksVcX2N3LsrcMhrKxSKi93c06MZh6JzSLWe5bl9hvUvBdEuwDrk-fQgD3ZlmjjoevRWYhv_kslW1PlqUHYmKOQ7csUw.3mvvsFWikEjZzExA.YixjnnzzcPRy_uUpgPv5zqOfshv3pUwfrME0AijpsB7u9CmJe94g6f2y_3vqUps-5weKKGZyk3ZtnwEbPVAk9-HZt-Y27SbZl4JNCFEOLVsMsK8.h4j9BdFXuWKKez6xxRAwJA"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the authentication fails, the response should be a <code>401 Unauthorized</code> HTTP status code.</p>
</div>
<div class="paragraph">
<p>If the HTTP method in the request is not <code>POST</code>, the response must be a <code>405 Method Not Allowed</code> HTTP status code.</p>
</div>
<div class="paragraph">
<p>If the request is invalid, the response shall be a <code>400 Bad Request</code> HTTP status code.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="__2_as_a_user_i_want_to_logout_so_that_my_token_is_no_longer_valid">#2. As a user, I want to logout, so that my token is no longer valid</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Logout is only possible with stateful token storages.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There must be a logout endpoint to allow users remove their token from the token storage. An example request would be
like this:</p>
</div>
<div class="listingblock">
<div class="title">Listing 3. User Story 2: logout endpoint</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">POST /logout HTTP/1.1
Host: api.example.com
Authorization: Bearer eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00ifQ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the token is passed in the <code>Authorization</code> HTTP Header, as specified in the RFC 6750 <a href="#rfc6750">[rfc6750]</a>.</p>
</div>
<div class="paragraph">
<p>If the token is found and removed, the response should be a <code>200 OK</code> HTTP status code. Otherwise, it will be a
<code>404 Not Found</code>.</p>
</div>
<div class="paragraph">
<p>If the HTTP method in the request is not <code>POST</code>, the response must be a <code>405 Method Not Allowed</code> HTTP status code.</p>
</div>
<div class="paragraph">
<p>If the request is invalid, the response shall be a <code>400 Bad Request</code> HTTP status code.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="__3_as_a_developer_i_want_to_configure_how_access_tokens_are_generated">#3. As a developer, I want to configure how access tokens are generated</h4>
<div class="paragraph">
<p>Token generation should be configurable by users. There are 2 scenarios:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If using JWT, generated tokens will conform to the RFC 6750 <a href="#rfc6750">[rfc6750]</a> specification, and therefore it won&#8217;t be
possible to override it. In this case, token will have a fixed expiration time, that must be also configurable. The
tokens will expire after the indicated period, regardless of having being accessed or not.</p>
</li>
<li>
<p>Otherwise, tokens will be a set of random alphanumeric characters of 32 char length, stored in any token storage
(see next user story). In this case, tokens will have a configurable expiration time, that might be refreshed on
every access, depending on the underlying storage support for such action.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The plugin must provide at least one implementation for each scenario.</p>
</div>
</div>
<div class="sect3">
<h4 id="__4_as_a_developer_i_want_to_store_tokens_on_multiple_storages_including_the_client_itself">#4. As a developer, I want to store tokens on multiple storages, including the client itself</h4>
<div class="paragraph">
<p>If using JWT, tokens will be stored on the client. Assuming the client is a front-end application using a Javascript MVC
framework like Angular JS <a href="#angular-js">[angular-js]</a>, the place to store such token would be HTML 5&#8217;s <code>localStorage</code>.</p>
</div>
<div class="paragraph">
<p>Otherwise, the plugin must enable the developer to configure a stateful storage to store the tokens into. The plugin
must provide at least one implementation for storing tokens in a relational database, and in an in-memory storage
solution.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="__5_as_a_user_i_want_to_validate_whether_my_access_token_is_still_valid_or_not">#5. As a user, I want to validate whether my access token is still valid or not</h4>
<div class="sect4">
<h5 id="_token_validation_filter">Token validation filter</h5>
<div class="paragraph">
<p>The plugin must provide a Spring Security Filter (based on Java EE Servlet filters) that will validate the token
received on every request. If the validation is successful, the plugin will restore the user principal into the
Spring Security&#8217;s <code>SecurityContext</code>.</p>
</div>
<div class="paragraph">
<p>This will enable developers to transparently secure their endpoints using Spring Security utils like the
<code>@Secured</code> annotation or the <code>SpringSecurityService</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 4. User Story 5: securing a controller action</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import grails.converters.JSON

class UserController {
    SpringSecurityService springSecurityService

    @Secured
    def me() {
        render [username: springSecurityService.principal.username] as JSON
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above action might be accessed like this:</p>
</div>
<div class="listingblock">
<div class="title">Listing 5. User Story 5: accessing a protected endpoint</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">GET /user/me HTTP/1.1
Host: api.example.com
Authorization: Bearer eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00ifQ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assuming the token is valid, the response might be like this:</p>
</div>
<div class="listingblock">
<div class="title">Listing 6. User Story 5: successful protected endpoint response</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">200 OK HTTP/1.1
Content-Type: application/json
{ "username": "raul.gonzalez" }</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the token is invalid, the response should be a <code>401 Unauthorized</code> HTTP status code, indicating that the request is
not sufficiently authenticated.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect4">
<h5 id="_token_validation_endpoint">Token validation endpoint</h5>
<div class="paragraph">
<p>There must be a token validation endpoint available for users to check whether a token is still valid or not.</p>
</div>
<div class="paragraph">
<p>Example usage:</p>
</div>
<div class="listingblock">
<div class="title">Listing 7. User Story 5: token validation endpoint request</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">POST /validate HTTP/1.1
Host: api.example.com
Authorization: Bearer eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00ifQ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the token is valid, the response should be like:</p>
</div>
<div class="listingblock">
<div class="title">Listing 8. User Story 5: token validation endpoint response</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">200 OK HTTP/1.1
Content-Type: application/json
{
   "username": "admin",
   "roles": [
      "ROLE_ADMIN",
      "ROLE_USER"
   ],
   "expires_in": 3600,
   "token_type": "Bearer",
   "refresh_token": "eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00ifQ...",
   "access_token": "eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00ifQ..."
}</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect3">
<h4 id="__6_as_a_developer_i_want_to_expose_cors_headers_in_the_responses_so_that_the_system_can_be_used_from_separated_front_end_applications">#6. As a developer, I want to expose CORS headers in the responses, so that the system can be used from separated front-end applications</h4>
<div class="paragraph">
<p>Cross-Origin Resource Sharing <a href="#cors">[cors]</a> is a mechanism that allows restricted resources on a web page to be requested
from another domain outside the domain from which the resource originated.</p>
</div>
<div class="paragraph">
<p>In the context of separated front-ends and backends, it might be possible that the front-end is running on a different
domain (<code>www.example.com</code>) than the backend (<code>api.example.com</code>).</p>
</div>
<div class="paragraph">
<p>When CORS request is needed, the browser will issue first a so-called pre-flight request, asking the server for its
CORS capabilities:</p>
</div>
<div class="listingblock">
<div class="title">Listing 9. User Story 6: pre-flight request in CORS.</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">OPTIONS /user/me HTTP/1.1
Origin: http://www.example.com
Access-Control-Request-Method: GET
Host: api.example.com
Accept-Language: en-GB
Connection: keep-alive
User-Agent: Mozilla/5.0...</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the server has CORS enabled, it will indicated allowed origins and HTTP methods in the response:</p>
</div>
<div class="listingblock">
<div class="title">Listing 10. User Story 6: pre-flight response in CORS.</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">Access-Control-Allow-Origin: http://www.example.com
Access-Control-Allow-Methods: GET, POST, PUT</code></pre>
</div>
</div>
<div class="paragraph">
<p>The browser will then check if the origin domain and the HTTP is allowed, and will make the actual request. If the
server disallows any of them, the browser will halt the request, throwing an error in the console.</p>
</div>
<div class="paragraph">
<p>The plugin must offer support for enabling CORS.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="__7_as_a_user_i_want_to_authenticate_using_external_oauth_providers_such_as_google_or_facebook">#7. As a user, I want to authenticate using external OAuth providers such as Google or Facebook</h4>
<div class="paragraph">
<p>This plugin is meant to be used in applications serving a REST API&#8217;s to pure Javascript clients. The main authentication
flow of this plugin is to allow you to authenticate your users against any Spring Security-compatible user directory
(like a DB or an LDAP server).</p>
</div>
<div class="paragraph">
<p>However, there might be situations where you want to delegate the authentication against a third-party provider, like
Google or Facebook. Unfortunately, your pure Javascript front-end application cannot request the providers directly using
OAuth, because then the access keys will be made public.</p>
</div>
<div class="paragraph">
<p>So is this plugin&#8217;s responsibility to provide endpoints so your Grails backend acts as a proxy for your front-end client.</p>
</div>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>The flow is something like the following:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="pluginDocs/oauth.png" alt="oauth">
</div>
<div class="title">Figure 2. OAuth delegation protocol</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The client application requests and endpoint that requires authentication, so the server responds with a 401 response.</p>
</li>
<li>
<p>The client redirects the user to the login form.</p>
</li>
<li>
<p>This time, instead of using username and password, the user clicks on "Login with Google" button.</p>
</li>
<li>
<p>Browser navigates to a Grails URL. Grails will generate a Google Login URL, giving Google a Grails callback URL.</p>
</li>
<li>
<p>Browser navigates to Google Login. User logs in, and Google redirects the browser to the Grails callback URL.</p>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Browser navigates to that Grails callback URL. Then, Grails will use OAuth to fetch user information (like email) from
Google. Based on that, will generate a REST API token and fetch and store principal information. The response from
Grails will be a front-end URL where the token is a parameter.</p>
</li>
<li>
<p>The browser will navigate to that URL, and the Javascript logic will read the token from the URL and store it locally.</p>
</li>
<li>
<p>The client sends again a request to the protected resource, passing the token as an HTTP header.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The plugin must provide configurable support to delegate the authentication to, at least, Google, Facebook and Twitter.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_legal_framework">Legal framework</h3>
<div class="paragraph">
<p>The applicable legislation to any software application using this plugin is the Data Protection Act: <em>"Ley Orgánica 15/1999,
de 13 de diciembre, de Protección de Datos de Carácter Personal"</em> <a href="#lopd">[lopd]</a>. The law stablishes a series of protection levels
depending on how sensitive is the data stored.</p>
</div>
<div class="paragraph">
<p>Basically, any data subject to the most basic security level (<em>"nivel básico"</em>) must be accessed by uniquely identified
users. Organisations have also the obligation to grant confidentiality and integrity of the passwords stored.</p>
</div>
<div class="paragraph">
<p>In the case of Spring Security, the library offers sufficient mechanism to be compliant with the lay restrictions.
However, is the developer&#8217;s responsibility to ensure that the configuration applied matches the required security
restrictions by the law.</p>
</div>
<div class="paragraph">
<p>Spring Security Core plugin (foundation for the Spring Security REST plugin) uses the <strong>bcrypt</strong> <a href="#bcrypt">[bcrypt]</a> algorithm to hash passwords.
In addition, developers can increase the security of the passwords by adding a salt.</p>
</div>
<div class="paragraph">
<p>Bcrypt is a much more secure alternative to the message digest approaches since it supports a customizable work level
which when increased takes more computation time to hash the users' passwords, but also dramatically increases the cost
of brute force attacks. Given how easy it is to use GPUs to crack passwords, developers should definitely consider using
bcrypt for new projects and switching to it for existing projects. Note that due to the approach used by bcrypt,
developers cannot add an additional salt like with the message digest algorithms.</p>
</div>
<div class="paragraph">
<p>It can be enabled by using the <code>bcrypt</code> value for the algorithm config attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">grails.plugin.springsecurity.password.algorithm = 'bcrypt'</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_design">Design</h3>
<div class="sect3">
<h4 id="_use_cases">Use cases</h4>
<div class="paragraph">
<p>In software and systems engineering, a use case is a list of action or event steps, typically defining the interactions
between a role (known in UML as an <strong>actor</strong>) and a system, to achieve a goal. The actor can be a human, an external system,
or time. In systems engineering, use cases are used at a higher level than within software engineering, often
representing missions or stakeholder goals.</p>
</div>
<div class="paragraph">
<p>In UML, use cases are represented through use cases diagrams. They containg the following key elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Use cases</strong>. A use case describes a sequence of actions that provide something of measurable value to an actor and is
drawn as a horizontal ellipse.</p>
</li>
<li>
<p><strong>Actors</strong>. An actor is a person, organization, or external system that plays a role in one or more interactions with
your system. Actors are drawn as stick figures.</p>
</li>
<li>
<p><strong>Associations</strong>. Associations between actors and use cases are indicated in use case diagrams by solid lines. An
association exists whenever an actor is involved with an interaction described by a use case. Associations are modeled
as lines connecting use cases and actors to one another, with an optional arrowhead on one end of the line. The
arrowhead is often used to indicating the direction of the initial invocation of the relationship or to indicate the
primary actor within the use case. The arrowheads are typically confused with data flow and as a result
some people avoid their use.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="use-case-example.png" alt="use case example">
</div>
<div class="title">Figure 3. Use case example</div>
</div>
<div style="page-break-after: always;"></div>
<div class="sect4">
<h5 id="_user_use_cases">User use cases</h5>
<div class="imageblock">
<div class="content">
<img src="use-cases-user.png" alt="use cases user">
</div>
<div class="title">Figure 4. User use cases</div>
</div>
</div>
<div class="sect4">
<h5 id="_developer_use_cases">Developer use cases</h5>
<div class="imageblock">
<div class="content">
<img src="use-cases-developer.png" alt="use cases developer">
</div>
<div class="title">Figure 5. Developer use cases</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect3">
<h4 id="_class_diagrams">Class diagrams</h4>
<div class="paragraph">
<p>Below are included some class diagrams of the most important parts of the system.</p>
</div>
<div class="sect4">
<h5 id="_filters">Filters</h5>
<div class="imageblock">
<div class="content">
<img src="class-filters.png" alt="class filters">
</div>
<div class="title">Figure 6. Filters class diagram</div>
</div>
<div class="paragraph">
<p>The provided filters, as specified in the user stories, implement the interface <code>javax.servlet.Filter</code>, where the
important method is <code>doFilter(...)</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_events_and_listeners">Events and listeners</h5>
<div class="imageblock">
<div class="content">
<img src="class-events.png" alt="class events">
</div>
<div class="title">Figure 7. Events and listeners class diagram</div>
</div>
<div class="paragraph">
<p>Spring framework provides an eventing system, allowing application to register custom listeners. Spring Security
implements such interface, defining a generic <code>SecurityEventListener</code>. This plugin provides a concrete
<code>RestSecurityEventListener</code>, that handles <code>RestTokenCreationEvent</code>'s.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect4">
<h5 id="_providers_and_handlers">Providers and handlers</h5>
<div class="imageblock">
<div class="content">
<img src="class-provider.png" alt="class provider">
</div>
<div class="title">Figure 8. Providers and handlers class diagram</div>
</div>
<div class="paragraph">
<p><code>AuthenticationProvider</code> is a Spring Security interface to define pluggable authentication mechanisms. This plugin
provides one <code>RestAuthenticationProvider</code> to authenticate requests based on an access token.</p>
</div>
<div class="paragraph">
<p>Depending on the result of the authentication, it might be delegated to either <code>RestAuthenticationSuccessHandler</code> or
to <code>RestAuthenticationFailureHandler</code>.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect4">
<h5 id="_credentials_extraction">Credentials extraction</h5>
<div class="imageblock">
<div class="content">
<img src="class-credentials.png" alt="class credentials">
</div>
<div class="title">Figure 9. Credentials extraction class diagram</div>
</div>
<div class="paragraph">
<p>In the authentication filter (login), credentials can be extracted from different sources. Mainly, from a JSON payload
and from request parameters. However, the plugin is flexible enough to allow the users to plug in their own
implementation.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect4">
<h5 id="_token_generation">Token generation</h5>
<div class="imageblock">
<div class="content">
<img src="class-token-generation.png" alt="class token generation">
</div>
<div class="title">Figure 10. Token generation class diagram</div>
</div>
<div class="paragraph">
<p>As specified in the user stories, token generation is also pluggable. The plugin offers implementation for both
stateless tokens (JWT) and non-stateless. In the case of JWT, there are also 2 options: signed and encrypted tokens.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect4">
<h5 id="_token_storage">Token storage</h5>
<div class="imageblock">
<div class="content">
<img src="class-token-storage.png" alt="class token storage">
</div>
<div class="title">Figure 11. Token storage class diagram</div>
</div>
<div class="paragraph">
<p>Here we can see the different implementations for token storage:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Stateless</strong>: JWT.</p>
</li>
<li>
<p><strong>Stateful</strong>: Memcached, GORM (database), Grails cache plugin (which uses Spring Cache abstraction) and Redis.</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_development">Development</h3>
<div class="paragraph">
<p>Creating the plugin to its current state has taken 2 years and 37 releases. It has been an enormous effort.</p>
</div>
<div class="paragraph">
<p>The first stages of the development were invested in learning the internals of Spring Security. I had previous experience
with it as a user, and in fact, is not the fist plugin I have created on top of it (in 2011 I wrote a plugin for
Spring Security SAML). Spring Security is a very well designed yet complex library, with a lot of custom concepts and
interfaces, such as <code>Authentication</code>, <code>AuthenticationProvider</code>, <code>Filter</code> and so on. It took me a while to figure out
the best way to achieve my goals.</p>
</div>
<div class="paragraph">
<p>My initial approach was to strip down many things I didn&#8217;t need nor want from Spring Security, such as the form-based
authentication or the dependency on the HTTP Session. That resulted in a plugin that was perfectly fitted for being
used from a separated front-end application. As a consequence, it effectively disabled old Spring Security ways of
authentication.</p>
</div>
<div class="paragraph">
<p>However, it turned out that users were including it in applications where both traditional and REST authentication was
used. Thus, I revisited my approach and allowed the users to use my features on a per filter-chain basis (see
Chapter A.4 in the appendix).</p>
</div>
<div class="sect3">
<h4 id="_testing">Testing</h4>
<div class="paragraph">
<p>Considering that it&#8217;s a plugin that people use in their applications, stability and robustness has always been a key
factor. And they use it for one of the most critical aspects in an application: security.</p>
</div>
<div class="paragraph">
<p>I have invested a significantly amount of time of the development in writing tests, at all levels: unit, integration
and functional. Nothing can prove the absence of all bugs, true. However, it&#8217;s certainly possible to prove the absence
of many common classes of bugs.</p>
</div>
<div class="paragraph">
<p>It&#8217;s important to note that, in a HTTP-based security system you need to test using an HTTP client. If you mock such
interfaces, you have the risk of not testing the system under real conditions, and this is not acceptable for a security
component.</p>
</div>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>The functional testing part of the project is composed of 3 full Grails applications with the plugin installed that perform
hundreds of HTTP requests and specifies assertions on the results. Not only there are a considerable amount of tests
across the project, but also they all run automatically on every push to GitHub, so I can ensure that no regressions
are introduced by having an automated Continuous Integration system running on Travis CI <a href="#travis">[travis]</a>.</p>
</div>
<div class="paragraph">
<p>Tests are written using Spock <a href="#spock">[spock]</a> and Geb <a href="#geb">[geb]</a>. This is how a functional test look like:</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. Sample functional test</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@IgnoreIf({ !SpringSecurityUtils.securityConfig.rest.oauth.facebook || !System.getenv('FB_PASSWORD') })
class FacebookSpec extends GebReportingSpec {

    void "it can sign users in with Facebook"() {
        when: "a user clicks on a 'Sign In with Facebook' button"
        go "/jwt/oauth/authenticate/facebook"

        then: "its redirected to Facebook Sign In page"
        FacebookSignInPage facebookSignInPage = at FacebookSignInPage

        when: "credentials are entered"
        facebookSignInPage.login 'open_pmazedy_user@tfbnw.net', System.getenv('FB_PASSWORD')

        then: "is redirected to the frontend callback URL, with a token"
        FrontendCallbackPage frontendCallbackPage = at FrontendCallbackPage
        frontendCallbackPage.jsUrl.contains("token")
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above test executes over a running testing Grails application with the plugin installed, opens a session in the
headless browser Phantom JS <a href="#phantom-js">[phantom-js]</a>, and interacts with the web as if it were a real user, filling forms, clicking
buttons, etc.</p>
</div>
<div style="page-break-after: always;"></div>
<div class="imageblock">
<div class="content">
<img src="tests.png" alt="tests">
</div>
<div class="title">Figure 12. Unit test report</div>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_continuous_integration_and_automated_release">Continuous integration and automated release</h4>
<div class="paragraph">
<p>The continuous integration pipeline is a complex process, totally automated. It runs all the suite of tests across all
the testing applications whenever something is pushed to GitHub. This ensures that the branches are stable all the time.</p>
</div>
<div class="paragraph">
<p>Current status of the build can be seen at <a href="https://travis-ci.org/alvarosanchez/grails-spring-security-rest" class="bare">https://travis-ci.org/alvarosanchez/grails-spring-security-rest</a>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="travis.png" alt="travis">
</div>
<div class="title">Figure 13. Travis build status</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installation_and_usage">Installation and usage</h3>
<div class="paragraph">
<p>Documentation has been one of the key factors contributing to the success of this plugin. It&#8217;s comprehensive, covers
all features, has configuration examples and it&#8217;s also automatically published online on every release. Its publishing
is also automated and versioned: <a href="http://alvarosanchez.github.io/grails-spring-security-rest" class="bare">http://alvarosanchez.github.io/grails-spring-security-rest</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="docs.png" alt="docs">
</div>
</div>
<div class="paragraph">
<p>For reference, it has been included in the appendix of this document. Please refer to that section for more information.</p>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-10-07 12:53:16 UTC
</div>
</div>
</body>
</html>