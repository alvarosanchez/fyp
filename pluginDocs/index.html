<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<title>Introduction to the Spring Security REST plugin</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove the comments around the @import statement below when using this as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
#map_canvas img,#map_canvas embed,#map_canvas object,.map_canvas img,.map_canvas embed,.map_canvas object{max-width:none!important}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
.antialiased,body{-webkit-font-smoothing:antialiased}
img{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{display:inline-block;color:rgba(0,0,0,.8);font-size:.75em;line-height:1.4;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:-.15em .15em 0 .15em;padding:.2em .6em .2em .5em;vertical-align:middle;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.05em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.spread{width:100%}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1{padding-right:.75em;font-weight:bold}
td.hdlist1,td.hdlist2{vertical-align:top}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none}
span.footnote,span.footnoteref{vertical-align:super;font-size:.875em}
span.footnote a,span.footnoteref a{text-decoration:none}
span.footnote a:active,span.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em;line-height:1.3;font-size:.875em;margin-left:1.2em;text-indent:-1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
h1,h2{letter-spacing:-.01em}
dt,th.tableblock,td.content{text-rendering:optimizeLegibility}
p,td.content{letter-spacing:-.01em}
p strong,td.content strong{letter-spacing:-.005em}
p,blockquote,dt,td.content{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img{page-break-inside:avoid}
thead{display:table-header-group}
img{max-width:100%!important}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
</head>
<body class="book">
<div id="header">
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel2">
<li><a href="#_introduction_to_the_spring_security_rest_plugin">Introduction to the Spring Security REST plugin</a></li>
<li><a href="#_what_s_new_in_1_5">What&#8217;s new in 1.5?</a></li>
<li><a href="#_what_s_new_in_1_4">What&#8217;s new in 1.4?</a></li>
<li><a href="#_configuration">Configuration</a></li>
<li><a href="#_events">Events</a></li>
<li><a href="#_authentication_endpoint">Authentication Endpoint</a></li>
<li><a href="#_token_generation">Token Generation</a></li>
<li><a href="#_token_storage">Token Storage</a></li>
<li><a href="#_token_rendering">Token Rendering</a></li>
<li><a href="#_token_validation_filter">Token Validation Filter</a></li>
<li><a href="#_cors_support">CORS support</a></li>
<li><a href="#_delegating_authentication_to_oauth_providers">Delegating authentication to OAuth providers</a></li>
<li><a href="#_debugging">Debugging</a></li>
<li><a href="#_frequently_asked_questions">Frequently Asked Questions</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect2">
<h3 id="_introduction_to_the_spring_security_rest_plugin">Introduction to the Spring Security REST plugin</h3>
<div class="paragraph">
<p>The Spring Security REST Grails plugin allows you to use Spring Security for a stateless, token-based, RESTful authentication.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This plugin depends on <a href="http://grails-plugins.github.io/grails-spring-security-core/guide/newInV2.html">Spring Security Core 2.x</a>.
Make sure your application is compatible with that version first. There is a
<a href="https://github.com/alvarosanchez/grails-spring-security-rest/issues/15">feature request</a>, that may be addressed in the
future if there is enough community interest / love :)</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This plugin is only for Grails 2.x, and it requires at least Java 7.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The default behaviour of Spring Security is to store the authenticated principal in the HTTP session. However, in a
RESTful scenario, we need to make sure our server is stateless.</p>
</div>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>The typical flow could be the following:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="rest.png" alt="rest">
</div>
<div class="title">Figure 1. Sequence diagram overview of the plugin behavior</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The client application requests and endpoint that requires authentication, so the server responds with a 401 response.</p>
</li>
<li>
<p>The client redirects the user to the login form.</p>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>The user enter credentials, and the client sends a request to the authentication endpoint. The server validates credentials, and if valid, generates, stores and sends back a token to the client.</p>
</li>
<li>
<p>The client then stores the token internally. It will be sent on every API method request.</p>
</li>
<li>
<p>The client sends again a request to the protected resource, passing the token as an HTTP header.</p>
</li>
<li>
<p>The server validates the token, and if valid, executes the actual operation requested.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As per the <a href="http://en.wikipedia.org/wiki/Representational_state_transfer">REST definition</a>, the client is transferring its
state on every request so the server is truly stateless.</p>
</div>
<div class="paragraph">
<p>This plugin helps you to wire your existing Spring Security authentication mechanism, provides you
with ready-to-use token generation strategies and comes prepackaged with JWT, Memcached, GORM, Redis
and Grails Cache support for token storage.</p>
</div>
<div style="page-break-after: always;"></div>
<div class="sect3">
<h4 id="_release_history">Release History</h4>
<div class="paragraph">
<p>You can view all releases at <a href="https://github.com/alvarosanchez/grails-spring-security-rest/releases" class="bare">https://github.com/alvarosanchez/grails-spring-security-rest/releases</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>19 August 2015</p>
<div class="ulist">
<ul>
<li>
<p>1.5.2</p>
</li>
</ul>
</div>
</li>
<li>
<p>6 May 2015</p>
<div class="ulist">
<ul>
<li>
<p>1.5.1</p>
</li>
</ul>
</div>
</li>
<li>
<p>6 May 2015</p>
<div class="ulist">
<ul>
<li>
<p>1.5.0</p>
</li>
</ul>
</div>
</li>
<li>
<p>21 April 2015</p>
<div class="ulist">
<ul>
<li>
<p>1.5.0.RC4</p>
</li>
</ul>
</div>
</li>
<li>
<p>13 April 2015</p>
<div class="ulist">
<ul>
<li>
<p>1.5.0.RC3</p>
</li>
</ul>
</div>
</li>
<li>
<p>9 April 2015</p>
<div class="ulist">
<ul>
<li>
<p>1.5.0.RC2</p>
</li>
</ul>
</div>
</li>
<li>
<p>2 April 2015</p>
<div class="ulist">
<ul>
<li>
<p>1.5.0.RC1</p>
</li>
</ul>
</div>
</li>
<li>
<p>1 April 2015</p>
<div class="ulist">
<ul>
<li>
<p>1.5.0.M3</p>
</li>
</ul>
</div>
</li>
<li>
<p>24 February 2015</p>
<div class="ulist">
<ul>
<li>
<p>1.5.0.M2</p>
</li>
</ul>
</div>
</li>
<li>
<p>3 February 2015</p>
<div class="ulist">
<ul>
<li>
<p>1.5.0.M1</p>
</li>
</ul>
</div>
</li>
<li>
<p>28 January 2015</p>
<div class="ulist">
<ul>
<li>
<p>1.4.1</p>
</li>
</ul>
</div>
</li>
<li>
<p>12 November 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.4.1.RC2</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<div class="ulist">
<ul>
<li>
<p>20 October 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.4.1.RC1</p>
</li>
</ul>
</div>
</li>
<li>
<p>12 August 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.4.0</p>
</li>
</ul>
</div>
</li>
<li>
<p>14 July 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.4.0.RC5</p>
</li>
</ul>
</div>
</li>
<li>
<p>4 July 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.4.0.RC4</p>
</li>
</ul>
</div>
</li>
<li>
<p>24 June 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.4.0.RC3</p>
</li>
</ul>
</div>
</li>
<li>
<p>24 June 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.4.0.RC2</p>
</li>
</ul>
</div>
</li>
<li>
<p>20 June 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.4.0.RC1</p>
</li>
</ul>
</div>
</li>
<li>
<p>11 June 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.4.0.M3</p>
</li>
</ul>
</div>
</li>
<li>
<p>1 June 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.4.0.M2</p>
</li>
</ul>
</div>
</li>
<li>
<p>29 May 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.4.0.M1</p>
</li>
</ul>
</div>
</li>
<li>
<p>23 April 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.3.4</p>
</li>
</ul>
</div>
</li>
<li>
<p>16 April 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.3.3</p>
</li>
</ul>
</div>
</li>
<li>
<p>3 April 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.3.2</p>
</li>
</ul>
</div>
</li>
<li>
<p>18 March 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.3.1</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<div class="ulist">
<ul>
<li>
<p>4 March 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.3.0</p>
</li>
</ul>
</div>
</li>
<li>
<p>17 February 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.2.5</p>
</li>
</ul>
</div>
</li>
<li>
<p>10 February 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.2.4</p>
</li>
</ul>
</div>
</li>
<li>
<p>4 February 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.2.3</p>
</li>
</ul>
</div>
</li>
<li>
<p>31 January 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.2.2</p>
</li>
</ul>
</div>
</li>
<li>
<p>15 January 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.2.0</p>
</li>
</ul>
</div>
</li>
<li>
<p>14 January 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.1.0</p>
</li>
</ul>
</div>
</li>
<li>
<p>13 January 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.0.1</p>
</li>
</ul>
</div>
</li>
<li>
<p>12 January 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.0.0</p>
</li>
</ul>
</div>
</li>
<li>
<p>10 January 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.0.0.RC2</p>
</li>
</ul>
</div>
</li>
<li>
<p>31 December 2013</p>
<div class="ulist">
<ul>
<li>
<p>Initial 1.0.0.RC1 release.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_what_s_new_in_1_5">What&#8217;s new in 1.5?</h3>
<div class="sect3">
<h4 id="_jwt_support">JWT support</h4>
<div class="paragraph">
<p>JWT is fully supported and is now the default token "storage" mechanism. If you still want to use your previous storage
(such as Memcached or GORM), make sure you explicitly set to <code>true</code> one of the following properties:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. New configuration values in 1.5</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Config key</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.useMemcached</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.useGorm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.useGrailsCache</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If switching over JWT, the logout behavior is not available anymore. Read the documentation on how to
implement your own logout strategy if you want to.</p>
</div>
</div>
<div class="sect3">
<h4 id="_redis_support">Redis support</h4>
<div class="paragraph">
<p>Redis can now be used as token storage service. Thanks to <a href="https://github.com/peh">Philipp Eschenbach</a> for
his initial contribution.</p>
</div>
</div>
<div class="sect3">
<h4 id="_new_package_base">New package base</h4>
<div class="paragraph">
<p>Packages <code>com.odobo.grails.plugin.springsecurity.rest.*</code> have been refactored to simply <code>grails.plugin.springsecurity.rest.*</code>.
Make sure to double-check your imports when upgrading to 1.5.</p>
</div>
</div>
<div class="sect3">
<h4 id="_other_minor_changes">Other minor changes</h4>
<div class="ulist">
<ul>
<li>
<p>The plugin now uses Grails 2.4.4, and the build and tests are executed with Java 8.</p>
</li>
<li>
<p>Documentation for older versions is now published at <a href="http://alvarosanchez.github.io/grails-spring-security-rest" class="bare">http://alvarosanchez.github.io/grails-spring-security-rest</a></p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_what_s_new_in_1_4">What&#8217;s new in 1.4?</h3>
<div class="sect3">
<h4 id="_full_compatibility_with_spring_security_core">Full compatibility with Spring Security core.</h4>
<div class="paragraph">
<p>Up to previous releases, this plugin was overriding "stateful" Spring Security core beans, to ensure a stateless behaviour.
After some users reported issues integrating this plugin with existing installations, version 1.4 now follows a more
friendly approach.</p>
</div>
<div class="paragraph">
<p>A new chapter has been created explaining how to configure the filter chains appropriately.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rfc_6750_bearer_token_support_by_default">RFC 6750 Bearer Token support by default</h4>
<div class="paragraph">
<p>Now, the token validation and rendering aligns with the <a href="http://tools.ietf.org/html/rfc6750">RFC 6750 Bearer Token</a> spec.
If you want to keep the old behaviour, simply disable it by setting
<code>grails.plugin.springsecurity.rest.token.validation.useBearerToken = false</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_credentials_are_extracted_from_json_by_default">Credentials are extracted from JSON by default</h4>
<div class="paragraph">
<p>It makes more sense in a REST application. The old behaviour can still be used by using the corresponding configuration
property.</p>
</div>
</div>
<div class="sect3">
<h4 id="_anonymous_access_is_allowed">Anonymous access is allowed</h4>
<div class="paragraph">
<p>In case you want to enable anonymous access (read: not authenticated) to certain URL patterns, you can do so. Take a
look at the [new chapter in the documentation|guide:tokenValidation].</p>
</div>
</div>
<div class="sect3">
<h4 id="_other_minor_changes_2">Other minor changes</h4>
<div class="ulist">
<ul>
<li>
<p>Upgraded dependencies:</p>
<div class="ulist">
<ul>
<li>
<p><code>spring-security-core:2.0-RC3</code>.</p>
</li>
<li>
<p><code>cors:1.1.6</code>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration">Configuration</h3>
<div class="paragraph">
<p>Once the plugin is installed, you are ready to go. The default configuration is to use signed
JWT&#8217;s for tokens. However, you can select any other token storage strategy:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Grails Cache.</p>
</li>
<li>
<p>Memcached.</p>
</li>
<li>
<p>GORM.</p>
</li>
<li>
<p>Redis.</p>
</li>
<li>
<p>Provide your own: implement
<a href="http://alvarosanchez.github.io/grails-spring-security-rest/latest/docs/gapi/grails/plugin/springsecurity/rest/token/storage/TokenStorageService.html">TokenStorageService</a>
and register it in <code>resources.groovy</code> as <code>tokenStorageService</code>.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_plugin_configuration">Plugin configuration</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This plugin depends on <a href="http://grails-plugins.github.io/grails-spring-security-core/docs/manual/guide/newInV2.html">Spring Security Core 2.x</a>.
Make sure your application is compatible with that version first.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This plugin is compatible by default with Spring Security core traditional, form-based authentication. The important thing
to remember is: you have to separate the filter chains, so different filters are applied on each case.</p>
</div>
<div class="paragraph">
<p>The stateless, token-based approach of this plugin is incompatible with the HTTP session-based approach of Spring Security,
core, so the trick is to identify what URL patterns have to be stateless, and what others have to be stateful (if any).</p>
</div>
<div class="paragraph">
<p>To configure the chains properly, you can use the <code>grails.plugin.springsecurity.filterChain.chainMap</code> property:</p>
</div>
<div class="listingblock">
<div class="title">Listing 1. <code>grails.plugin.springsecurity.filterChain.chainMap</code></div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">grails.plugin.springsecurity.filterChain.chainMap = [
    '/api/**': 'JOINED_FILTERS,-exceptionTranslationFilter,-authenticationProcessingFilter,-securityContextPersistenceFilter,-rememberMeAuthenticationFilter',  // Stateless chain
    '/**': 'JOINED_FILTERS,-restTokenValidationFilter,-restExceptionTranslationFilter'                                                                          // Traditional chain
]</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>To understand this syntax, please read the
<a href="http://grails-plugins.github.io/grails-spring-security-core/guide/filters.html">Spring Security Core documentation</a>.
Long story short: <code>JOINED_FILTERS</code> refers to all the configured filters. The minus (<code>-</code>) notation means all the previous values
but the neglected one.</p>
</div>
<div class="paragraph">
<p>So the first chain applies all the filters except the stateful ones. The second one applies all the filters but the stateless ones.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Make sure that the stateless chain applies not only to your REST controllers, but also to the URL&#8217;s where this plugin
filters are listening: by default, <code>/api/login</code> for authentication, <code>/api/logout</code> for
logout and <code>/api/validate</code> for token validation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The difference is that, in a traditional form-based authentication, Spring Security will respond with an HTTP 302 redirect
to the login controller. That doesn&#8217;t work for an API, so in the stateless approach, an HTTP 401 response will be sent back.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_events">Events</h3>
<div class="paragraph">
<p>The Spring Security Rest plugin fires events exactly like Spring Security Core does.</p>
</div>
<div class="sect3">
<h4 id="_event_notification">Event Notification</h4>
<div class="paragraph">
<p>You can set up event notifications in two ways. The sections that follow describe each approach in more detail.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Register an event listener, ignoring events that do not interest you. Spring allows only partial event subscription;
you use generics to register the class of events that interest you, and you are notified of that class and all subclasses.</p>
</li>
<li>
<p>Register one or more callback closures in <code>grails-app/conf/Config.groovy</code> that take advantage of the plugin&#8217;s
<code>grails.plugin.springsecurity.rest.RestSecurityEventListener</code>. The listener does the filtering for you.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_authenticationeventpublisher">AuthenticationEventPublisher</h5>
<div class="paragraph">
<p>Spring Security REST publishes events using an
<a href="http://docs.spring.io/spring-security/site/docs/3.2.x/apidocs/org/springframework/security/authentication/AuthenticationEventPublisher.html">AuthenticationEventPublisher</a>
which in turn fire events using the
<a href="http://docs.spring.io/spring/docs/3.1.x/javadoc-api/org/springframework/context/ApplicationEventPublisher.html">ApplicationEventPublisher</a>.
By default no events are fired since the <code>AuthenticationEventPublisher</code> instance registered is a
<code>grails.plugin.springsecurity.rest.authentication.NullRestAuthenticationEventPublisher</code>. But you can enable event
publishing by setting <code>grails.plugin.springsecurity.useSecurityEventListener = true</code> in <code>grails-app/conf/Config.groovy</code>.</p>
</div>
<div class="paragraph">
<p>You can use the <code>useSecurityEventListener</code> setting to temporarily disable and enable the callbacks, or enable them
per-environment.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect4">
<h5 id="_token_creation">Token Creation</h5>
<div class="paragraph">
<p>Currently the Spring Security REST plugin supports a single event in addition to the default spring security events.
The event is fired whenever a new token is created. See <code>grails.plugin.springsecurity.rest.RestTokenCreationEvent</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Every time a token is successfully submitted, an <code>AuthenticationSuccessEvent</code> will be fired.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_registering_an_event_listener">Registering an Event Listener</h4>
<div class="paragraph">
<p>Enable events with <code>grails.plugin.springsecurity.useSecurityEventListener = true</code> and create one or more Groovy or Java
classes, for example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 2. Custom event listener</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">package com.foo.bar

import org.springframework.context.ApplicationListener
import grails.plugin.springsecurity.rest.RestTokenCreationEvent

class MySecurityEventListener
      implements ApplicationListener&lt;RestTokenCreationEvent&gt; {

   void onApplicationEvent(RestTokenCreationEvent event) {
      // The access token is a delegate of the event, so you have access to an instance of `grails.plugin.springsecurity.rest.token.AccessToken`
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Register the class in <code>grails-app/conf/spring/resources.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 3. Event listener registration</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import com.foo.bar.MySecurityEventListener

beans = {
   mySecurityEventListener(MySecurityEventListener)
}</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_registering_callback_closures">Registering Callback Closures</h4>
<div class="paragraph">
<p>Alternatively, enable events with <code>grails.plugin.springsecurity.useSecurityEventListener = true</code> and register one or
more callback closure(s) in <code>grails-app/conf/Config.groovy</code> and let <code>SecurityEventListener</code> do the filtering.</p>
</div>
<div class="paragraph">
<p>Implement the event handlers that you need, for example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 4. Callback closures</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">grails.plugin.springsecurity.useSecurityEventListener = true

grails.plugin.springsecurity.onRestTokenCreationEvent = { e, appCtx -&gt;
   // handle RestTokenCreationEvent
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>None of these closures are required; if none are configured, nothing will be called. Just implement the event handlers
that you need.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_authentication_endpoint">Authentication Endpoint</h3>
<div class="paragraph">
<p>The <a href="http://alvarosanchez.github.io/grails-spring-security-rest/latest/docs/gapi/grails/plugin/springsecurity/rest/RestAuthenticationFilter.html">authentication filter</a>
uses the default <code>authenticationManager</code> bean, which in turn uses all the registered authentication
providers. See the <a href="http://grails-plugins.github.io/grails-spring-security-core/guide/authenticationProviders.html">Spring Security Core guide</a>
for more information about how to define your own providers. Note that you can easily plug any Spring Security sub-plugin
(like the LDAP one) to use a different authentication strategy.</p>
</div>
<div class="paragraph">
<p>If the authentication is successful, a token generator is used to generate a token, and a
token storage implementation is used to store the token. Finally, the JSON response sent back to the
client is rendered by a <code>restAuthenticationTokenJsonRenderer</code> bean. See the token rendering documentation for more details.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This authentication filter will only be applied to the above configured URL and can also be disabled, in case a different approach
for token creation is followed. In the rest of the cases, the request will continue through the filter chain, reaching Spring Security
Core filters. Bear in mind that, by default, Spring Security Core 2.x locks down all URL&#8217;s unless a explicit securiy rule has been
specified for each of them.</p>
</div>
<div class="paragraph">
<p>See <a href="http://grails-plugins.github.io/grails-spring-security-core/guide/single.html#requestMappings">Spring Security Core documentation</a>
for more information.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following are the <code>Config.groovy</code> properties available:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Authentication configuration options</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Config key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.login.active</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.login.endpointUrl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/api/login</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.login.failureStatusCode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>401</code></p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
<div class="sect3">
<h4 id="_extracting_credentials_from_the_request">Extracting credentials from the request</h4>
<div class="paragraph">
<p>The plugin supports 2 ways of extracting the username and password: using request parameters, and using a JSON payload.
To align with the RESTful principles, JSON payload is the default behaviour.</p>
</div>
<div class="sect4">
<h5 id="_from_a_json_request">From a JSON request</h5>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 3. JSON credentials extraction configuration properties</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Config key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.login.useJsonCredentials</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.login.usernamePropertyName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>username</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.login.passwordPropertyName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>password</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The default implementation expects a request like this:</p>
</div>
<div class="listingblock">
<div class="title">Listing 5. Example JSON authentication request</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">{
    "username": "john.doe",
    "password": "dontTellAnybody"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use <code>usernamePropertyName</code> and <code>passwordPropertyName</code> properties mentioned above, your JSON request can look like:</p>
</div>
<div class="listingblock">
<div class="title">Listing 6. Custom JSON authentication request</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">{
    "login": "john.doe",
    "pwd": "dontTellAnybody"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the following config:</p>
</div>
<div style="page-break-after: always;"></div>
<div class="listingblock">
<div class="title">Listing 7. Custom JSON authentication configuration properties</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">grails.plugin.springsecurity.rest.login.usernamePropertyName = 'login'
grails.plugin.springsecurity.rest.login.passwordPropertyName = 'pwd'</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your JSON request format is different, you can plug your own implementation by defining a class which extends
<code>http://alvarosanchez.github.io/grails-spring-security-rest/latest/docs/gapi/grails/plugin/springsecurity/rest/credentials/AbstractJsonPayloadCredentialsExtractor.html[AbstractJsonPayloadCredentialsExtractor]</code>.
The default implementation looks like this:</p>
</div>
<div class="listingblock">
<div class="title">Listing 8. <code>DefaultJsonPayloadCredentialsExtractor</code></div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Slf4j
class DefaultJsonPayloadCredentialsExtractor extends AbstractJsonPayloadCredentialsExtractor {

    String usernamePropertyName
    String passwordPropertyName

    UsernamePasswordAuthenticationToken extractCredentials(HttpServletRequest httpServletRequest) {
        def jsonBody = getJsonBody(httpServletRequest)

        if (jsonBody) {
            String username = jsonBody."${usernamePropertyName}"
            String password = jsonBody."${passwordPropertyName}"

            log.debug "Extracted credentials from JSON payload. Username: ${username}, password: ${password?.size()?'[PROTECTED]':'[MISSING]'}"

            new UsernamePasswordAuthenticationToken(username, password)
        } else {
            log.debug "No JSON body sent in the request"
            return null
        }
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you are done, register it in <code>resources.groovy</code> with the name <code>credentialsExtractor</code>.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect4">
<h5 id="_from_request_parameters">From request parameters</h5>
<div class="paragraph">
<p>Note that the name of the parameters can also be customised:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 4. Parameter extraction configuration options</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Config key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.login.useRequestParamsCredentials</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.login.usernamePropertyName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>username</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.login.passwordPropertyName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>password</code></p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect3">
<h4 id="_logout">Logout</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Logout is not possible when using JWT tokens (the default strategy), as no state is kept in the server. If
you still want to have logout, you can provide your own implementation by creating a subclass of
<a href="http://alvarosanchez.github.io/grails-spring-security-rest/latest/docs/gapi/grails/plugin/springsecurity/rest/token/storage/jwt/JwtTokenStorageService.html">JwtTokenStorageService</a>
and overriding the methods <code>storeToken</code> and <code>removeToken</code>.</p>
</div>
<div class="paragraph">
<p>Then, register your implementation in <code>resources.groovy</code> as <code>tokenStorageService</code>.</p>
</div>
<div class="paragraph">
<p>However, a more rational approach would be just to remove the token from the client (eg, browser&#8217;s local storage) and
let the tokens expire (they will expire anyway, unlike with other storages like Memcached or Redis where they get refreshed
on every access).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="http://alvarosanchez.github.io/grails-spring-security-rest/latest/docs/gapi/grails/plugin/springsecurity/rest/RestLogoutFilter.html">logout filter</a>
exposes an endpoint for deleting tokens. It will read the token from an HTTP header. If found, will delete it from the
storage, sending a 200 response. Otherwise, it will send a 404 response.</p>
</div>
<div class="paragraph">
<p>You can configure it in <code>Config.groovy</code> using this properties:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 5. Logout configuration options</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Config key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.logout.endpointUrl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/api/logout</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.validation.headerName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>X-Auth-Token</code></p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_token_generation">Token Generation</h3>
<div class="paragraph">
<p>By default, the plugin generates JWT tokens. Note that when using JWT, you can&#8217;t plug any other token generator.</p>
</div>
<div class="paragraph">
<p>If you are not using JWT, but any stateful strategy like Memcached or GORM, the following strategies are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://alvarosanchez.github.io/grails-spring-security-rest/latest/docs/gapi/grails/plugin/springsecurity/rest/token/generation/SecureRandomTokenGenerator.html">Using java.security.SecureRandom</a>.</p>
</li>
<li>
<p><a href="http://alvarosanchez.github.io/grails-spring-security-rest/latest/docs/gapi/grails/plugin/springsecurity/rest/token/generation/UUIDTokenGenerator.html">Using java.util.UUID</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The strategy used is configurable in <code>Config.groovy</code>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 6. Token generation configuration options</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Config key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.generation.useSecureRandom</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.generation.useUUID</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Both of them generate tokens of 32 alphanumeric characters.</p>
</div>
<div class="paragraph">
<p>That should be enough for most of the human beings. But if you still want to provide your own implementation,
simply write a class implementing
<a href="http://alvarosanchez.github.io/grails-spring-security-rest/latest/docs/gapi/grails/plugin/springsecurity/rest/token/generation/TokenGenerator.html">TokenGenerator</a>
and wire it up in <code>resources.groovy</code> as <code>tokenGenerator</code>.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_token_storage">Token Storage</h3>
<div class="paragraph">
<p>The tokens are stored on the server using a <code>tokenStorageService</code> bean. The plugin comes with out-of-the-box support
for JWT, Memcached, GORM and <a href="http://grails.org/plugin/cache">Grails Cache</a>, but you can use your own strategy implementing the
<a href="http://alvarosanchez.github.io/grails-spring-security-rest/latest/docs/gapi/grails/plugin/springsecurity/rest/token/storage/TokenStorageService.html">TokenStorageService</a>
interface.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The default implementation, JWT, is stateless. Nothing is really stored. However, the plugin still gives a
chance to the other implementations to store the principal if they need to.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_json_web_token">JSON Web Token</h4>
<div class="paragraph">
<p>JSON Web Token (JWT) is an <a href="http://tools.ietf.org/html/draft-ietf-oauth-json-web-token">IETF standard</a> (in progress)
which defines a secure way to encapsulate arbitrary data that can be sent over unsecure URL&#8217;s.</p>
</div>
<div class="paragraph">
<p>Generally speaking, JWT&#8217;s can be useful in the following use cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When generating "one click" action emails, like "delete this comment" or "add this to favorites". Instead of giving
the users URL&#8217;s like <code>/comment/delete/123</code>, you can give them something like <code>/comment/delete/&lt;JWT_TOKEN&gt;</code>, where the
<code>JWT_TOKEN</code> contains encapsulated information about the user and the comment, in a safe way, so authentication is not required.</p>
</li>
<li>
<p>To achieve single sign-on, by sharing a JWT across applications.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the context of authentication and authorization, JWT will help you implement a stateless implementation, as the
principal information is stored directly in the JWT.</p>
</div>
<div style="page-break-after: always;"></div>
<div class="sect4">
<h5 id="_how_does_a_jwt_looks_like">How does a JWT looks like?</h5>
<div class="imageblock">
<div class="content">
<img src="jwt.png" alt="jwt">
</div>
<div class="title">Figure 2. JWT example</div>
</div>
<div class="sect5">
<h6 id="_header">Header</h6>
<div class="paragraph">
<p>A base64-encoded JSON like:</p>
</div>
<div class="listingblock">
<div class="title">Listing 9. JWT header</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">{
    "alg": "HS256",
    "typ": "JWT"
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_claims">Claims</h6>
<div class="paragraph">
<p>A base64-encoded JSON like:</p>
</div>
<div class="listingblock">
<div class="title">Listing 10. JWT claims</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">{
    "exp": 1422990129,
    "sub": "jimi",
    "roles": [
        "ROLE_ADMIN",
        "ROLE_USER"
    ],
    "iat": 1422986529
}</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect5">
<h6 id="_signature">Signature</h6>
<div class="paragraph">
<p>Depends on the algorithm specified on the header, it can be a digital signature of the base64-encoded header and claims,
or an encryption of them using RSA.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_signed_jwt_s">Signed JWT&#8217;s</h5>
<div class="paragraph">
<p>By default, this plugin uses signed JWT&#8217;s as specified by the
<a href="https://tools.ietf.org/html/draft-ietf-jose-json-web-signature">JSON Web Signature</a> specification. More specifically,
the algorithm used is HMAC SHA-256 with a specified shared secret. The relevant configuration properties are:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 7. JWT configuration options for signing</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Config key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.useJwt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.jwt.useSignedJwt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.jwt.secret</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'qrD6h8K6S9503Q06Y6Rfk21TErImPYqa'</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.jwt.expiration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3600</code></p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect4">
<h5 id="_encrypted_jwt_s">Encrypted JWT&#8217;s</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Grails&#8217;s <code>grails-docs</code> artifact includes a version of <code>com.lowagie:itext</code> which in turns bring old BouncyCastle&#8217;s libraries
into the classpath. To avoid the problem, you have to override explicitly that dependency:</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. Excluding BouncyCastle&#8217;s libraries</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">build("com.lowagie:itext:2.0.8") { excludes "bouncycastle:bcprov-jdk14:138", "org.bouncycastle:bcprov-jdk14:1.38" }
{code}</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the previous strategy, the claims are just signed, so it prevents an attacker to tamper its contents to introduce
malicious data or try a privilege escalation by adding more roles. However, the claims can be decoded just by using
Base 64.</p>
</div>
<div class="paragraph">
<p>If the claims contains sensitive information, you can use a
<a href="https://tools.ietf.org/html/draft-ietf-jose-json-web-encryption">JSON Web Encryption</a> algorithm to prevent them to be decoded.
Particularly, this plugin uses RSAES OAEP for key encryption and AES GCM (Galois/Counter Mode) algorithm with a 256 bit key
for content encryption.</p>
</div>
<div class="paragraph">
<p>By default, RSA public/private keys ar generated every time the application runs. This means that  generated tokens
won&#8217;t be decrypted across executions of the application. So better create your own key pair using OpenSSL:</p>
</div>
<div class="listingblock">
<div class="title">Listing 12. Certificate generation for JWT</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">openssl genrsa -out private_key.pem 2048
openssl pkcs8 -topk8 -inform PEM -outform DER -in private_key.pem -out private_key.der -nocrypt
openssl rsa -in private_key.pem -pubout -outform DER -out public_key.der</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>Then, configure the keys properly, along with the rest of the configuration:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 8. JWT configuration options for signing</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Config key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.useJwt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.jwt.useEncryptedJwt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.jwt.privateKeyPath</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.jwt.publicKeyPath</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Example configuration:</p>
</div>
<div class="listingblock">
<div class="title">Listing 13. JWT encryption example configuration</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">grails.plugin.springsecurity.rest.token.storage.jwt.useEncryptedJwt = true
grails.plugin.springsecurity.rest.token.storage.jwt.privateKeyPath = '/path/to/private_key.der'
grails.plugin.springsecurity.rest.token.storage.jwt.publicKeyPath = '/path/to/public_key.der'</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The performance of encryption algorithms is much slower compared with signing ones. If you are considering encrypting
you JWT&#8217;s, think if you really need it.</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect4">
<h5 id="_token_expiration_and_refresh_tokens">Token expiration and refresh tokens</h5>
<div class="paragraph">
<p>When using JWT, issued access tokens expire after a period of time, and they are paired with refresh tokens, eg:</p>
</div>
<div class="listingblock">
<div class="title">Listing 14. Sample access token response, including refresh token</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">{
   "username": "jimi",
   "roles": [
      "ROLE_ADMIN",
      "ROLE_USER"
   ],
   "expires_in": 3600,
   "token_type": "Bearer",
   "refresh_token": "eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00ifQ.fUaSWIdZakFX7CyimRIPhuw0sfevgmwL2xzm5H0TuaqwKx24EafCO0TruGKG-lN-wGCITssnF2LQTqRzQGp0PoLXHfUJ0kkz5rBl6LtnRu7cdD1ZUNYXLJtFjQ3IATzoo15tPafRPyStG1Qm7-1L0VxquhrLxkkpti0F1_VTytZAq8ltFrnxM4ahJUwS7eriivvdLqmHtnwuXw0kBXEseIyCkiyKklWDJAcD_P_gHoQJvSCoXedlr7Pp0n6LEUrRWJ2Hb-Zyt9dWqWDxm9nyDeEVtEZGcQtpgCGgbXxaUpULIy5nvrbRzXSNyT6iXhK1CLqiFVkfh-Y-DHXdB6Q4sg.uYdpxl835KnlkqC5.gBgSnPWZOo6FINovJNG7Xx2RuS09QJbU4-_J4EgZQkygt8xE-HfdYaOmtmJLjGJR1XKoaRsuX1gNjFoCZgqWAon6.Zsrk52dkjskSVQLXZBQooQ",
   "access_token": "eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00ifQ.n-gGe65x0SlSXS3fTG8ZLdXvv6b5_1pDvkcGyCjFy-vm1VhaBEQL5p3hc6iUcCAcuyrqzGk95lV9dHCv46cNfCiUFHWfbEcd4nqScIxBbc28xO9L1mNLnZ0G1rx1Mx1L0Y_ZPoSxDXpJaHCT28cdZffHLxx2B9ioIClgdlYBAJ5Oz8VT39-D0QSomS6QhFqmcpbDsXrsKxs545Pn-TIlu-fSQ4wpIvAxusOKB6CV2EYKqBplMBrh-3btE8WksVcX2N3LsrcMhrKxSKi93c06MZh6JzSLWe5bl9hvUvBdEuwDrk-fQgD3ZlmjjoevRWYhv_kslW1PlqUHYmKOQ7csUw.3mvvsFWikEjZzExA.YixjnnzzcPRy_uUpgPv5zqOfshv3pUwfrME0AijpsB7u9CmJe94g6f2y_3vqUps-5weKKGZyk3ZtnwEbPVAk9-HZt-Y27SbZl4JNCFEOLVsMsK8.h4j9BdFXuWKKez6xxRAwJA"
}</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>Refresh tokens never expire, and can be used to obtain a new access token by sending a POST request to the
<code>/oauth/access_token</code> endpoint:</p>
</div>
<div class="listingblock">
<div class="title">Listing 15. Sample HTTP request to obtain an access token</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">POST /myApp/oauth/access_token HTTP/1.1
Host: server.example.com
Content-Type: application/x-www-form-urlencoded

grant_type=refresh_token&amp;refresh_token=eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00ifQ....</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, is a form request with 2 parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>grant_type</code>: must be <code>refres_token</code> always.</p>
</li>
<li>
<p><code>refresh_token</code>: the refresh token provided earlier.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As refresh tokens never expire, they must be securely stored in your client application. See
<a href="https://tools.ietf.org/html/rfc6749#section-10.4">section 10.4 of the OAuth 2.0 spec</a> for more information.</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect4">
<h5 id="_memcached">Memcached</h5>
<div class="paragraph">
<p>To use Memcached, simply define the following configuration properties to match your environments accordingly:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 9. Memcached configuration options</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Config key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.useMemcached</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.memcached.hosts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>localhost:11211</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.memcached.username</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>''</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.memcached.password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>''</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.memcached.expiration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3600</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For development, if you have Memcached installed locally with the default settings, just define
<code>grails.plugin.springsecurity.rest.token.storage.useMemcached = true</code>. It should work.</p>
</div>
<div class="paragraph">
<p>In Memcached tokens will expire automatically after the configured timeout (1h by default).
They get refreshed on every access</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect4">
<h5 id="_gorm">GORM</h5>
<div class="paragraph">
<p>To use GORM, these are the relevant configuration properties:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 10. GORM configuration options</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Config key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong>

<code>grails.plugin.springsecurity.rest.token.storage.useGorm</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.gorm.tokenDomainClassName</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.gorm.tokenValuePropertyName</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tokenValue</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.gorm.usernamePropertyName</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The relevant domain class should look something like this:</p>
</div>
<div class="listingblock">
<div class="title">Listing 16. Authentication token domain class example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">package org.example.product

class AuthenticationToken {

    String tokenValue
    String username

    static mapping = {
        version false
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For the <code>tokenDomainClassName</code> configuration you must enter a fully qualified class name. In the case of the example above:
<code>grails.plugin.springsecurity.rest.token.storage.gorm.tokenDomainClassName = 'org.example.product.AuthenticationToken'</code></p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>A few things to take into consideration when using GORM for token storage:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Instead of storing the whole <code>UserDetails</code> object, probably only the username is needed. This is because applications
using this strategy will probably have the standard User and Role domain classes. When the token is verified the username
is passed to the default <code>userDetailsService</code> bean, which in the case of the default Spring Security Core GORM
implementation will fetch the information from the mentioned domain classes.</p>
</li>
<li>
<p>GORM&#8217;s optimistic locking feature is likely unnecessary and may cause performance issues.</p>
</li>
<li>
<p>You&#8217;ll have to handle token expiration by yourself via Quartz jobs or a similar mechanism. There are various ways you might
go about this.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_gorm_token_expiration_examples">GORM Token Expiration Examples</h6>
<div class="paragraph">
<p>Adding a GORM autoTimestamp property like <code>lastUpdated</code> or <code>dateCreated</code> and sorting out stale or old tokens with Quartz jobs
are the most obvious routes. Each has its drawbacks though.</p>
</div>
<div class="paragraph">
<p><code>dateCreated</code> is useful if you want tokens to expire a set time after they are issued. However, API users who didn&#8217;t pay
attention to when their token was issued may find themselves needing a new token unexpectedly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">Date dateCreated</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>lastUpdated</code> requires a change to the token domain instance in order to be triggered. Something as simple as an access
counter may work as a strategy to keepTokens fresh, but doing a write to a disk based database on each token access may
be something you would prefer to avoid for the sake of performance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">Date lastUpdated
Integer accessCount = 0

def afterLoad() {
  accessCount++
}</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>Simply using your own date or timestamp is also a valid option.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">Date refreshed = new Date()

def afterLoad() {
    // if being accessed and it is more than a day since last marked as refreshed
    // and it hasn't been wiped out by Quartz job (it exists, duh)
    // then refresh it
    if (refreshed &lt; new Date() -1) {
        refreshed = new Date()
        it.save()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example quartz job to go with the custom refresh timestamp above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">class RemoveStaleTokensJob {
    static triggers = {
        cron name: 'every4hours', cronExpression: '0 0 */4 * * *'
    }

    void execute() {
        AuthenticationToken.executeUpdate('delete AuthenticationToken a where a.refreshed &lt; ?' [new Date()-1])
    }
}</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect4">
<h5 id="_redis">Redis</h5>
<div class="paragraph">
<p>To use Redis as a token store simply you just have to enable it in you configuration by setting <code>useRedis</code> to <code>true</code>
(see table below).</p>
</div>
<div class="paragraph">
<p>You have to have the <code>redis</code> plugin installed in order to be able to use Redis as your token store. Refer to the
<a href="https://github.com/grails-plugins/grails-redis">Redis plugin documentation</a> for more details about how to configure it.</p>
</div>
<div class="paragraph">
<p>Configuration options for Redis:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 11. Redis configuration options</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Config key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.useRedis</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.redis.expiration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3600</code></p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect3">
<h4 id="_grails_cache">Grails Cache</h4>
<div class="paragraph">
<p>To use <a href="http://grails.org/plugin/cache">Grails Cache</a>, simply define a cache name:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 12. Redis configuration options</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Config key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.useGrailsCache</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.grailsCacheName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The cache name should correspond to a name specified in the [cache DSL|http://grails-plugins.github.io/grails-cache/docs/manual/guide/usage.html#dsl].</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Token expiration / eviction / TTL</div>
<div class="paragraph">
<p>By default, Spring Cache abstraction
<a href="http://docs.spring.io/spring/docs/3.2.x/spring-framework-reference/html/cache.html#cache-specific-config">does not support expiration</a>.
It depends on the specific support of the actual providers. Grails has several plugins for this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://grails-plugins.github.io/grails-cache/guide/usage.html#dsl">Core</a>: unsupported.</p>
</li>
<li>
<p><a href="http://grails-plugins.github.io/grails-cache-ehcache/guide/usage.html#dsl">Ehcache</a>: supported.</p>
</li>
<li>
<p><a href="http://grails-plugins.github.io/grails-cache-redis/guide/usage.html#dsl">Redis</a>: unsupported.</p>
</li>
<li>
<p><a href="http://grails.org/plugin/cache-gemfire">Gemfire</a>: unsupported.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There is a bug in <code>:cache-ehcache:1.0.0</code> plugin that will cause issues. It&#8217;s recommended that you use the latest version.
See <a href="https://github.com/alvarosanchez/grails-spring-security-rest/issues/89">#89</a> for more information.</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_token_rendering">Token Rendering</h3>
<div class="paragraph">
<p>By default, this plugin renders the token in <a href="http://tools.ietf.org/html/rfc6750">RFC 6750 Bearer Token</a> format:</p>
</div>
<div class="listingblock">
<div class="title">Sample Access token response</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">HTTP/1.1 200 OK
Content-Type: application/json;charset=UTF-8
Cache-Control: no-store
Pragma: no-cache

{
    "access_token":"eyJhbGciOiJIUzI1NiJ9.eyJleHAiOjE0MjI5OTU5MjIsInN1YiI6ImppbWkiLCJyb2xlcyI6WyJST0xFX0FETUlOIiwiUk9MRV9VU0VSIl0sImlhdCI6MTQyMjk5MjMyMn0.rA7A2Gwt14LaYMpxNRtrCdO24RGrfHtZXY9fIjV8x8o",
    "token_type":"Bearer",
    "username": "john.doe",
    "roles": [
        "ROLE_ADMIN",
        "ROLE_USER"
    ]
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As per the RFC, <code>access_token</code> and <code>token_type</code> property names cannot be customised.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The JSON structure can be customised with the following configuration keys:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 13. Token rendering configuration options</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Config key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.rendering.usernamePropertyName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>username</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.rendering.authoritiesPropertyName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>roles</code></p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>E.g., with the following configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">grails.plugin.springsecurity.rest.token.rendering.usernamePropertyName = 'login'
grails.plugin.springsecurity.rest.token.rendering.authoritiesPropertyName = 'permissions'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output will look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">{
    "access_token":"eyJhbGciOiJIUzI1NiJ9.eyJleHAiOjE0MjI5OTU5MjIsInN1YiI6ImppbWkiLCJyb2xlcyI6WyJST0xFX0FETUlOIiwiUk9MRV9VU0VSIl0sImlhdCI6MTQyMjk5MjMyMn0.rA7A2Gwt14LaYMpxNRtrCdO24RGrfHtZXY9fIjV8x8o",
    "token_type":"Bearer",
    "login": "john.doe",
    "permissions": [
        "ROLE_ADMIN",
        "ROLE_USER"
    ]
}</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<div class="sect3">
<h4 id="_disabling_bearer_tokens_support_for_full_response_customisation">Disabling bearer tokens support for full response customisation</h4>
<div class="paragraph">
<p>In order to fully customise the response, you need first to disable bearer tokens support by setting
<code>grails.plugin.springsecurity.rest.token.validation.useBearerToken = false</code>. That will enable you to use this additional
property:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 14. Token rendering configuration options</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Config key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.rendering.tokenPropertyName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>access_token</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Disabling bearer token support impacts the way tokens are extracted from the HTTP request. Please, read carefully
the chapter about token validation first.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want your own implementation, simply create a class implementing
<a href="http://alvarosanchez.github.io/grails-spring-security-rest/docs/gapi/grails/plugin/springsecurity/rest/token/rendering/AccessTokenJsonRenderer.html">AccessTokenJsonRenderer</a>
and wire it up in <code>resources.groovy</code> with name <code>accessTokenJsonRenderer</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The principal object stored in the security context, and passed to the JSON renderer, is coming from the configured
authentication providers. In most cases, this will be a <code>UserDetails</code> object retrieved using the <code>userDetailsService</code> bean.</p>
</div>
<div class="paragraph">
<p>If you want to render additional information in your JSON response, you have to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configure an alternative <code>userDetailsService</code> bean that retrieves the additional information you want, and put it in a principal object.</p>
</li>
<li>
<p>Configure an alternative <code>accessTokenJsonRenderer</code> that reads that information from the <code>restAuthenticationToken.principal</code> object.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_token_validation_filter">Token Validation Filter</h3>
<div class="paragraph">
<p>The token validation filter looks for the token in the request and then tries to validate it using the configured
token storage implementation.</p>
</div>
<div class="paragraph">
<p>If the validation is successful, the principal object is stored in the security context. This allows you to use in
your application <code>@Secured</code>, <code>springSecurityService.principal</code> and so on.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>springSecurityService.currentUser</code> expects a <code>grails.plugin.springsecurity.userdetails.GrailsUser</code> to perform a DB query.
However, this plugins stores in the security context just a principal <code>Object</code>, because it does not assume you are using
domain classes to store the users. Use <code>springSecurityService.principal</code> instead.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This plugin supports <a href="http://tools.ietf.org/html/rfc6750">RFC 6750 Bearer Token</a> specification out-of-the-box.</p>
</div>
<div class="sect3">
<h4 id="_sending_tokens_in_the_request">Sending tokens in the request</h4>
<div class="paragraph">
<p>The token can be sent in the <code>Authorization</code> request header:</p>
</div>
<div class="listingblock">
<div class="title">Listing 17. Accessing a protected resource using <code>Authorization</code> request header</div>
<div class="content">
<pre class="highlight"><code>GET /protectedResource HTTP/1.1
Host: server.example.com
Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJleHAiOjE0MjI5OTU5MjIsInN1YiI6ImppbWkiLCJyb2xlcyI6WyJST0xFX0FETUlOIiwiUk9MRV9VU0VSIl0sImlhdCI6MTQyMjk5MjMyMn0.rA7A2Gwt14LaYMpxNRtrCdO24RGrfHtZXY9fIjV8x8o</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or using form-encoded body parameters:</p>
</div>
<div class="listingblock">
<div class="title">Listing 18. Accessing a protected resource using body parameters</div>
<div class="content">
<pre class="highlight"><code>POST /protectedResource HTTP/1.1
Host: server.example.com
Content-Type: application/x-www-form-urlencoded

access_token=eyJhbGciOiJIUzI1NiJ9.eyJleHAiOjE0MjI5OTU5MjIsInN1YiI6ImppbWkiLCJyb2xlcyI6WyJST0xFX0FETUlOIiwiUk9MRV9VU0VSIl0sImlhdCI6MTQyMjk5MjMyMn0.rA7A2Gwt14LaYMpxNRtrCdO24RGrfHtZXY9fIjV8x8o</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>If you need to use the <code>GET</code> HTTP method (to render images in an <code>img</code> tag, for example), you can also send the access token
in a query string parameter named <code>access_token</code>:</p>
</div>
<div class="paragraph">
<p>If you disable the bearer token support, you can customise it further:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">grails.plugin.springsecurity.rest.token.validation.useBearerToken = false
grails.plugin.springsecurity.rest.token.validation.headerName = 'X-Auth-Token'</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you still want to have full access and read the token from a different part of the request, you can implement a
<a href="http://alvarosanchez.github.io/grails-spring-security-rest/latest/docs/gapi/grails/plugin/springsecurity/rest/token/reader/TokenReader.html">TokenReader</a>
and register it in your <code>resources.groovy</code>  as <code>tokenReader</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You must disable bearer token support to register your own <code>tokenReader</code> implementation.</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_anonymous_access">Anonymous access</h4>
<div class="paragraph">
<p>If you want to enable anonymous access to URL&#8217;s where this plugin&#8217;s filters are applied, you need to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configure <code>enableAnonymousAccess = true</code> (see table below).</p>
</li>
<li>
<p>Make sure that the <code>anonymousAuthenticationFilter</code> is applied before <code>restTokenValidationFilter</code>. See how to configure filters for more details.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example, with this configuration:</p>
</div>
<div class="listingblock">
<div class="title">Sample configuration to allow anonymous access</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">grails {
    plugin {
        springsecurity {
            filterChain {
                chainMap = [
                    '/api/guest/**': 'anonymousAuthenticationFilter,restTokenValidationFilter,restExceptionTranslationFilter,filterInvocationInterceptor',
                    '/api/**': 'JOINED_FILTERS,-anonymousAuthenticationFilter,-exceptionTranslationFilter,-authenticationProcessingFilter,-securityContextPersistenceFilter',
                    '/**': 'JOINED_FILTERS,-restTokenValidationFilter,-restExceptionTranslationFilter'
                ]
            }

            //Other Spring Security settings
            //...

            rest {
                token {
                    validation {
                        enableAnonymousAccess = true
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>The following chains are configured:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>/api/guest/**</code> is a stateless chain that allows anonymous access when no token is sent. If however a token is on the request, it will be validated.</p>
</li>
<li>
<p><code>/api/**</code> is a stateless chain that doesn&#8217;t allow anonymous access. Thus, the token will always be required, and if missing, a Bad Request reponse will be sent back to the client.</p>
</li>
<li>
<p><code>/**</code> (read: everything else) is a traditional stateful chain.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_validation_endpoint">Validation Endpoint</h4>
<div class="paragraph">
<p>There is also an endpoint available that you can call in case you want to know if a given token is valid. It looks for
the token in a HTTP header as well, and if the token is still valid, it renders guide:authentication[its JSON representation].
If the token does not exist, it will render a <code>grails.plugin.springsecurity.rest.login.failureStatusCode</code> response
(<code>401</code> by default).</p>
</div>
<div class="paragraph">
<p>The relevant configuration properties for the validation endpoint are:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 15. Validation endpoint configuration options</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Config key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.validation.active</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.validation.headerName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>X-Auth-Token</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.validation.endpointUrl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/api/validate</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that <code>headerName</code> is only considered if <code>grails.plugin.springsecurity.rest.token.validation.useBearerToken</code> is set
to <code>false</code>. Otherwise (the default approach), as per RFC 6750, the header name will be <code>Authorization</code> and the value
will be <code>Bearer TOKEN_VALUE</code>.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_cors_support">CORS support</h3>
<div class="paragraph">
<p>This plugin comes pre-installed with the <a href="http://grails.org/plugin/cors">CORS plugin</a>, which enables
<a href="http://www.w3.org/TR/cors/">Cross-Origin Resource Sharing</a>. Refer to the
<a href="https://github.com/davidtinker/grails-cors/blob/master/README.md">plugin documentation</a> to learn how to configure it.</p>
</div>
<div class="paragraph">
<p>The CORS plugin activates itself by default. If you don&#8217;t want it for some environments, you can use
<code>cors.enabled = false</code> within the appropriate environment block in your <code>Config.groovy</code>.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t want CORS support at all, you can skip the plugin by excluding it
when defining this plugin in your <code>BuildConfig.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 19. Excluding the CORS plugin</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">compile ':spring-security-rest:{{VERSION}}', {
    exclude 'cors
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you have to explicitly expose the headers you are using for token validation. Otherwise, the frontend application
won&#8217;t be allowed to read them:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">cors.headers = ['Access-Control-Allow-Headers': 'Content-Type, Authorization']</code></pre>
</div>
</div>
<div class="paragraph">
<p>Be also aware of the default behaviour of the CORS plugin for <code>Access-Control-Allow-Origin</code> is to just echo the <code>Origin</code>
header sent by the browser. Make sure that in your production environment you properly configure the header.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_delegating_authentication_to_oauth_providers">Delegating authentication to OAuth providers</h3>
<div class="paragraph">
<p>This plugin is meant to be used in applications serving a REST API&#8217;s to pure Javascript clients. The main authentication
flow of this plugin is to allow you to authenticate your users against any Spring Security-compatible user directory
(like a DB or an LDAP server).</p>
</div>
<div class="paragraph">
<p>However, there might be situations where you want to delegate the authentication against a third-party provider, like
Google or Facebook. Unfortunately, your pure Javascript front-end application cannot request the providers directly using
OAuth, because then the access keys will be made public.</p>
</div>
<div class="paragraph">
<p>So is this plugin&#8217;s responsibility to provide endpoints so your Grails backend acts as a proxy for your front-end client.</p>
</div>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>The flow is something like the following:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="oauth.png" alt="oauth">
</div>
<div class="title">Figure 3. OAuth delegation protocol</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The client application requests and endpoint that requires authentication, so the server responds with a 401 response (*).</p>
</li>
<li>
<p>The client redirects the user to the login form (*).</p>
</li>
<li>
<p>This time, instead of using username and password, the user clicks on "Login with Google" button.</p>
</li>
<li>
<p>Browser navigates to a Grails URL. Grails will generate a Google Login URL, giving Google a Grails callback URL.</p>
</li>
<li>
<p>Browser navigates to Google Login. User logs in, and Google redirects the browser to the Grails callback URL.</p>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Browser navigates to that Grails callback URL. Then, Grails will use OAuth to fetch user information (like email) from
Google. Based on that, will generate a REST API token and fetch and store principal information. The response from
Grails will be a front-end URL where the token is a parameter.</p>
</li>
<li>
<p>The browser will navigate to that URL, and the Javascript logic will read the token from the URL and store it locally.</p>
</li>
<li>
<p>The client sends again a request to the protected resource, passing the token as an HTTP header (*).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The steps flagged with (*) remain unchanged from the normal flow.</p>
</div>
<div class="paragraph">
<p>The Grails callback URL mentioned above has this general format: <code>${grails.serverURL}/oauth/callback/${providerName}</code>.
You will need to configure such URL in your OAuth 2.0 provider.</p>
</div>
<div class="paragraph">
<p>To support OAuth, this plugin uses <a href="https://github.com/leleuj/pac4j">Profile &amp; Authentication Client for Java</a>. So you
can use any OAuth 2.0 provider they support. This includes at the time of writing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dropbox.</p>
</li>
<li>
<p>Facebook.</p>
</li>
<li>
<p>GitHub.</p>
</li>
<li>
<p>Google.</p>
</li>
<li>
<p>LinkedIn.</p>
</li>
<li>
<p>Windows Live.</p>
</li>
<li>
<p>Wordpress.</p>
</li>
<li>
<p>Yahoo.</p>
</li>
<li>
<p>Paypal.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that OAuth 1.0a providers also work, like Twitter.</p>
</div>
<div class="paragraph">
<p>The plugin also supports <a href="https://www.apereo.org/projects/cas">CAS (Central Authentication Service)</a> using the OAuth
authentication flow. See CAS Authentication for details.</p>
</div>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>To start the OAuth authentication flow, from your frontend application, generate a link to
<code>&lt;YOUR_GRAILS_APP&gt;/oauth/authenticate/&lt;provider&gt;</code>. The user clicking on that link represents step 4 in the previous
diagram.</p>
</div>
<div class="paragraph">
<p>Note that you can define the frontend callback URL in <code>Config.groovy</code> under
<code>grails.plugin.springsecurity.rest.oauth.frontendCallbackUrl</code>. You need to define a closure that will be called with
the token value as parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">grails.plugin.springsecurity.rest.oauth.frontendCallbackUrl = { String tokenValue -&gt; "http://my.frontend-app.com/welcome.token=${tokenValue}" }</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also define the URL as a <code>callback</code> parameter in the original link, eg:</p>
</div>
<div class="paragraph">
<p><code>http://your-grails-api.com/oauth/authenticate/google?callback=http://your-frontend-app.com/auth-success.html?token=</code></p>
</div>
<div class="paragraph">
<p>In this case, the token will be <strong>concatenated</strong> to the end of the URL.</p>
</div>
<div class="paragraph">
<p>Upon successful OAuth authorisation (after step 6.1 in the above diagram), an
<a href="http://alvarosanchez.github.io/grails-spring-security-rest/latest/docs/gapi/grails/plugin/springsecurity/rest/oauth/OauthUser.html">OauthUser</a>
will be stored in the security context. This is done by a bean named <code>oauthUserDetailsService</code>. The
<a href="http://alvarosanchez.github.io/grails-spring-security-rest/latest/docs/gapi/grails/plugin/springsecurity/rest/oauth/DefaultOauthUserDetailsService.html">default implementation</a>
delegates to the configured <code>userDetailsService</code> bean, passing the profile ID as the username:</p>
</div>
<div style="page-break-after: always;"></div>
<div class="listingblock">
<div class="title">Listing 20. DefaultOauthUserDetailsService</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">/**
 * Builds an {`link OauthUser}. Delegates to the default {`link UserDetailsService.loadUserByUsername(java.lang.String)}
 * where the username passed is {`link UserProfile.getId()}. If the user is not found, it will create a new one with
 * the the default roles.
 */
@Slf4j
class DefaultOauthUserDetailsService implements OauthUserDetailsService {

    @Delegate
    UserDetailsService userDetailsService

    UserDetailsChecker preAuthenticationChecks

    OauthUser loadUserByUserProfile(CommonProfile userProfile, Collection&lt;GrantedAuthority&gt; defaultRoles)
            throws UsernameNotFoundException {
        UserDetails userDetails
        OauthUser oauthUser

        try {
            log.debug "Trying to fetch user details for user profile: ${userProfile}"
            userDetails = userDetailsService.loadUserByUsername userProfile.id

            log.debug "Checking user details with ${preAuthenticationChecks.class.name}"
            preAuthenticationChecks?.check(userDetails)

            Collection&lt;GrantedAuthority&gt; allRoles = userDetails.authorities + defaultRoles
            oauthUser = new OauthUser(userDetails.username, userDetails.password, allRoles, userProfile)
        } catch (UsernameNotFoundException unfe) {
            log.debug "User not found. Creating a new one with default roles: ${defaultRoles}"
            oauthUser = new OauthUser(userProfile.id, 'N/A', defaultRoles, userProfile)
        }

        return oauthUser
    }

}</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>If you want to provide your own implementation, define it in <code>resources.groovy</code> with bean name <code>oauthUserDetailsService</code>.
Make sure you implements the interface <code>OauthUserDetailsService</code></p>
</div>
<div class="paragraph">
<p>If you want to do any additional post-OAuth authorisation check, you should do it on your <code>loadUserByUserProfile</code>
implementation. This is useful if you want to allow your corporate users to log into your application using their Gmail
account. In this case, you should decide based on OAuth20Profile.getEmail(), for instance:</p>
</div>
<div class="listingblock">
<div class="title">Listing 21. Custom loadUserByUserProfile implementation</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">OauthUser loadUserByUserProfile(OAuth20Profile userProfile, Collection&lt;GrantedAuthority&gt; defaultRoles) throws UsernameNotFoundException {
    if (userProfile.email.endsWith('example.org')) {
        return new OauthUser(userProfile.id, 'N/A', defaultRoles, userProfile)
    } else {
        throw new UsernameNotFoundException("User with email ${userProfile.email} now allowed. Only `example.org accounts are allowed.")
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case of any OAuth authentication failure, the plugin will redirect back to the frontend application anyway, so it
has a chance to render a proper error message and/or offer the user the option to try again. In that case, the token
parameter will be empty, and both <code>error</code> and <code>message</code> params will be appended:</p>
</div>
<div class="paragraph">
<p><code>http://your-frontend-app.com/auth-success.html?token=&amp;error=403&amp;message=User+with+email+jimmy%40gmail.com+now+allowed.+Only+%40example.com+accounts+are+allowed</code></p>
</div>
<div class="paragraph">
<p>Below are some examples on how to configure it for Google, Facebook and Twitter.</p>
</div>
<div style="page-break-after: always;"></div>
<div class="sect4">
<h5 id="_google">Google</h5>
<div class="paragraph">
<p>Define the following block in your <code>Config.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 22. Google OAuth sample configuration</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">grails {
    plugin {
        springsecurity {

            rest {

                oauth {

                    frontendCallbackUrl = { String tokenValue -&gt; "http://my.frontend-app.com/welcome#token=${tokenValue}" }

                    google {

                        client = org.pac4j.oauth.client.Google2Client
                        key = 'xxxx.apps.googleusercontent.com'
                        secret = 'xxx'
                        scope = org.pac4j.oauth.client.Google2Client.Google2Scope.EMAIL_AND_PROFILE
                        defaultRoles = ['ROLE_USER', 'ROLE_GOOGLE']

                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>scope</code> can be from any value of the enum <code>org.pac4j.oauth.client.Google2Client.Google2Scope</code>. But if you use the
default <code>OauthUserDetailsService</code>, you need to use <code>EMAIL_AND_PROFILE</code>. That is because the default implementation
uses the profile ID as the username, and that is only returned by Google if <code>EMAIL_AND_PROFILE</code> scope is used.</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect4">
<h5 id="_facebook">Facebook</h5>
<div class="paragraph">
<p>Define the following block in your <code>Config.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 23. Facebook OAuth sample configuration</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">grails {
    plugin {
        springsecurity {

            rest {

                oauth {

                    frontendCallbackUrl = { String tokenValue -&gt; "http://my.frontend-app.com/welcome#token=${tokenValue}" }

                    facebook {

                        client = org.pac4j.oauth.client.FacebookClient
                        key = 'xxx'
                        secret = 'yyy'
                        scope = 'email,user_location'
                        fields = 'id,name,first_name,middle_name,last_name,username'
                        defaultRoles = ['ROLE_USER', 'ROLE_FACEBOOK']
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>scope</code> is a comma-separated list, <strong>without blanks</strong>, of Facebook permissions. See the
<a href="https://developers.facebook.com/docs/reference/login/">Facebook documentation</a> for more details.</p>
</div>
<div class="paragraph">
<p><code>fields</code> may contain a comma-separated list, <strong>without blanks</strong>, of
<a href="https://developers.facebook.com/docs/graph-api/reference/user/">user fields</a>.</p>
</div>
<div class="paragraph">
<p>Both <code>scope</code> and <code>fields</code> are optional, but it&#8217;s highly recommendable to fine tune those lists so you don&#8217;t ask for
information you don&#8217;t need.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect4">
<h5 id="_twitter">Twitter</h5>
<div class="paragraph">
<p>Define the following block in your <code>Config.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 24. Twitter OAuth sample configuration</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">grails {
    plugin {
        springsecurity {

            rest {

                oauth {

                    frontendCallbackUrl = { String tokenValue -&gt; "http://my.frontend-app.com/welcome#token=${tokenValue}" }

                    twitter {

                        client = org.pac4j.oauth.client.TwitterClient
                        key = 'xxx'
                        secret = 'yyy'
                        defaultRoles = ['ROLE_USER', 'ROLE_TWITTER']
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is no additional configuration for Twitter.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect4">
<h5 id="_cas_central_authentication_service">CAS (Central Authentication Service)</h5>
<div class="paragraph">
<p>Define the following block in your <code>Config.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 25. CAS sample configuration</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">grails {
    plugin {
        springsecurity {

            rest {

                oauth {

                    frontendCallbackUrl = { String tokenValue -&gt; "http://my.frontend-app.com/welcome#token=${tokenValue}" }

                    cas {

                        client = org.pac4j.cas.client.CasClient
                        casLoginUrl = "https://my.cas-server.com/cas/login"
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Set <code>casLoginUrl</code> to the login URL of your CAS server.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_debugging">Debugging</h3>
<div class="paragraph">
<p>If you need debug information, you can specify the following entries in <code>Config.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 26. Logging setup</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">log4j = {
    ...

    debug  'grails.plugin.springsecurity',
           'grails.app.controllers.grails.plugin.springsecurity',
           'grails.app.services.grails.plugin.springsecurity',
           'org.pac4j',
           'org.springframework.security'

    ...
}</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_frequently_asked_questions">Frequently Asked Questions</h3>
<div class="sect5">
<h6 id="_why_this_token_based_implementation_can_t_i_use_http_basic_authentication">Why this token-based implementation? Can&#8217;t I use HTTP basic authentication?</h6>
<div class="paragraph">
<p>In theory you can. The only restriction to be truly stateless is to not use HTTP sessions at all. So if you go with
basic authentication, you need to transfer the credentials back and forth every time.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s think about that. Keep in mind that your frontend is a pure HTML/Javascript application, consuming a REST API
from the Grails side. So the first time, the Javascript application will make an API query and will receive a 401 response
indicating that authentication is required. Then you present the user a form to enter credentials, you grab them, <strong>encode</strong>
them with Base64 and in the next request, you send an HTTP header like <code>Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==</code>.</p>
</div>
<div class="paragraph">
<p>Now remember you are doing RESTful application, so the session state is maintained in the client. That means that you
would need to store that Base64 encoded string somewhere: cookies? HTML5 local storage? In any case, they are accessible
using browser tools. And that&#8217;s the point: there is a huge security risk because Base64 it&#8217;s not encryption, just encoding.
And it can be easily decoded.</p>
</div>
<div class="paragraph">
<p>You could argue that someone can access the token in the browser. Yes, but having the token will not allow him to obtain
user&#8217;s credentials. The tokens are just not decodable. And they can be revoked if necessary.</p>
</div>
<div class="paragraph">
<p>Fortunately for you, a token-based solution is not a magic idea that I only got; it&#8217;s actually a specification:
<a href="http://tools.ietf.org/html/rfc6750">RFC 6750 - The OAuth 2.0 Authorization Framework: Bearer Token Usage</a>.</p>
</div>
<div class="paragraph">
<p>Moreover, if you use tokens, you have the chance to implement expiration policies.</p>
</div>
<div class="paragraph">
<p>A couple of link with further explanations on the token-based flow:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.jamesward.com/2013/05/13/securing-single-page-apps-and-rest-services" class="bare">http://www.jamesward.com/2013/05/13/securing-single-page-apps-and-rest-services</a></p>
</li>
<li>
<p><a href="http://blog.brunoscopelliti.com/authentication-to-a-restful-web-service-in-an-angularjs-web-app" class="bare">http://blog.brunoscopelliti.com/authentication-to-a-restful-web-service-in-an-angularjs-web-app</a></p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect5">
<h6 id="_why_can_t_the_api_be_secured_with_oauth">Why can&#8217;t the API be secured with OAuth?</h6>
<div class="paragraph">
<p><a href="http://tools.ietf.org/html/rfc6749">RFC 6749 - OAuth 2.0</a> specification does cover this scenario in what they call
"public clients":</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Clients incapable of maintaining the confidentiality of their credentials (e.g., clients executing on the device used by the
resource owner, such as an installed native application or a web browser-based application), and incapable of secure client
authentication via any other means.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The OAuth 2.0 specification supports public clients with the implicit grant. This plugin supports that by default when
you delegate the authentication to another OAuth provider. If it&#8217;s you who are authenticating the users
(via DB, LDAP, etc), the token-based flow of this plugin is <em>OAuth-ish</em>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_why_you_didn_t_use_any_of_the_existing_oauth_plugins_why_pac4j">Why you didn&#8217;t use any of the existing OAuth plugins? Why pac4j?</h6>
<div class="paragraph">
<p>I&#8217;m aware of plugins like <a href="http://grails.org/plugin/oauth">OAuth</a> and
<a href="http://grails.org/plugin/spring-security-oauth">Spring Security OAuth</a>, but all of them rely on Spring Security Core&#8217;s
way of using HTTP sessions. So not acceptable.</p>
</div>
<div class="paragraph">
<p>I chose pac4j because:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>They support major OAuth 2.0 providers out-of-the-box, whereas Scribe does not.</p>
</li>
<li>
<p>It&#8217;s deadly simple and works just fine.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>I&#8217;m also aware of a pac4j-spring-security module. See my previous response on HTTP sessions.</p>
</div>
</div>
<div class="sect5">
<h6 id="_dude_this_is_awesome_how_can_i_compensate_you">Dude, this is awesome. How can I compensate you?</h6>
<div class="paragraph">
<p>I doubt you can :). You may try giving me free beers the next time you see me in a conference. Or you can just express
your gratitude via <a href="https://twitter.com/alvaro_sanchez">Twitter</a>.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-09-27 08:09:45 UTC
</div>
</div>
</body>
</html>